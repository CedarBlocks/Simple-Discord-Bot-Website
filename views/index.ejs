<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet" type="text/css" href="style.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
    crossorigin="anonymous"></script>
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
  <title>QR It</title>
  <link rel="icon" type="image/png"
    href="https://cdn.glitch.com/1b27de60-fcea-46be-8e8f-b9e02c018d2e%2Ffavicon.ico?v=1591023169143" />
  <meta charset="UTF-8" />
  <meta name="description" content="Website for the Discord bot QR It" />
  <meta name="keywords" content="bot, discord, chatbot, QRCode, QR, code, shorten, link, url, chat" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="CedarBlocks" />
</head>

<body>
  <%- include ("./partials/navbar.ejs") %>
  <h1 id="title">QR It</h1>
  
  <div id="main">
    <!-- Bot Stats Section -->
    <div class="stats-container">
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fa fa-server" aria-hidden="true"></i>
        </div>
        <div class="stat-content">
          <div class="stat-label">Servers</div>
          <div class="stat-value" id="serverCount">Loading...</div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fa fa-circle" aria-hidden="true"></i>
        </div>
        <div class="stat-content">
          <div class="stat-label">Status</div>
          <div class="stat-value">
            <span id="botStatus" class="status-indicator">
              <span class="status-dot" id="statusDot"></span>
              <span id="statusText">Loading...</span>
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Top.gg Widget -->
    <div class="widget-container">
      <a href="https://top.gg/bot/702935974308741140" target="_blank">
        <img src="https://top.gg/api/widget/702935974308741140.svg" alt="QR It on Top.gg" class="topgg-widget" />
      </a>
    </div>
  </div>

  <script>
    // Fetch bot stats from API
    async function fetchBotStats() {
      try {
        const response = await fetch('/api/status');
        const data = await response.json();
        
        // Update server count
        const serverCount = data.serverCount || 0;
        document.getElementById('serverCount').textContent = serverCount.toLocaleString();
        
        // Update status
        const status = data.status || 'offline';
        const statusText = document.getElementById('statusText');
        const statusDot = document.getElementById('statusDot');
        
        if (status === 'online') {
          statusText.textContent = 'Online';
          statusDot.className = 'status-dot status-online';
        } else {
          statusText.textContent = 'Offline';
          statusDot.className = 'status-dot status-offline';
        }
      } catch (error) {
        console.error('Error fetching bot stats:', error);
        document.getElementById('serverCount').textContent = 'N/A';
        document.getElementById('statusText').textContent = 'Unknown';
        document.getElementById('statusDot').className = 'status-dot status-offline';
      }
    }

    // Fetch stats on page load
    fetchBotStats();
    
    // Refresh stats every 10 minutes
    setInterval(fetchBotStats, 10 * 60 * 1000);
  </script>
</body>

</html>